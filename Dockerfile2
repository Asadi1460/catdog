# Use an official TensorFlow runtime as a parent image
FROM tensorflow/tensorflow:2.12.0

# Set the working directory in the container
WORKDIR /app

# Copy the current directory contents into the container at /app
COPY . /app

# Install OpenGL libraries
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        libgl1-mesa-glx \
        libegl1-mesa \
        libxrandr2 \
        libxrandr2 \
        libxss1 \
        libxcursor1 \
        libxcomposite1 \
        libasound2 \
        libxi6 \
        libxtst6 \
    && rm -rf /var/lib/apt/lists/*

# Install build dependencies for numpy
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        build-essential \
        libblas-dev \
        liblapack-dev \
        libatlas-base-dev \
        gfortran \
        fonts-noto \
    && rm -rf /var/lib/apt/lists/*

# Install required Python packages
RUN pip install \
    numpy==1.23.5 \
    opencv-python \
    tensorflow==2.12.0 \
    streamlit==1.24.1

# Make port 8501 available to the world outside this container
EXPOSE 8501

# Run the Streamlit app when the container launches
CMD ["python", "-m", "streamlit", "run", "app.py", "--server.port", "8501", "--server.address", "0.0.0.0"]

